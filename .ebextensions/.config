container_commands:
    01_syncdb:    
        command: "django-admin.py syncdb --noinput"
        leader_only: true
    02_populate:
        command: "python populate.py"
        leader_only: true
    03_collectstatic:
        command: "django-admin.py collectstatic --noinput"
        leader-only: true

option_settings:
    "aws:elasticbeanstalk:application:environment":
        DJANGO_SETTINGS_MODULE: "lmsunsw.settings"
        "PYTHONPATH": "/opt/python/current/app:$PYTHONPATH"
    "aws:elasticbeanstalk:container:python":
        WSGIPath: lmsunsw/wsgi.py
        NumProcesses: 3
        NumThreads: 20
    "aws:elasticbeanstalk:container:python:staticfiles":
        "/static/": "static/"
    "aws:cloudformation:template:parameter":
        "InstancePort": 9999

Resources:
    AWSEBLoadBalancer:
        Type: AWS::ElasticLoadBalancing::LoadBalancer
        Properties:
            Listeners:
                - InstancePort: 80
                  LoadBalancerPort: 80
                  Protocol: TCP
                - InstancePort: 9999
                  LoadBalancerPort: 9999
                  Protocol: TCP
                - InstancePort: 6379
                  LoadBalancerPort: 6379
                  Protocol: TCP
            AvailabilityZones:
                - ap-southeast-2
            HealthCheck:
                Timeout: 5
                Target: TCP:80
                Interval: 30
                HealthyThreshold: 3
                UnhealthyThreshold: 5